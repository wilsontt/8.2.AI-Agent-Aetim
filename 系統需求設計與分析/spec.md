# 系統需求規格文件 (System Requirements Specification)

**專案名稱**：AI 驅動之自動化威脅情資管理系統 (AETIM)  
**文件版本**：v1.0.0  
**撰寫日期**：2025-11-21  
**最後修訂**：2025-11-21  
**文件狀態**：已核准 (Approved)

---

## 目錄

1. [目的](#1-目的)
2. [範圍](#2-範圍)
3. [權責](#3-權責)
4. [名詞解釋](#4-名詞解釋)
5. [作業內容](#5-作業內容)
   - [5.1 基礎建設與情資定義模組](#51-基礎建設與情資定義模組)
   - [5.2 自動化收集與關聯分析模組](#52-自動化收集與關聯分析模組)
   - [5.3 報告生成與即時通知模組](#53-報告生成與即時通知模組)
   - [5.4 Web 管理界面模組](#54-web-管理界面模組)
   - [5.5 非功能性需求](#55-非功能性需求)
6. [參考文件](#6-參考文件)
7. [使用表單](#7-使用表單)

---

## 1. 目的

本文件旨在定義「AI 驅動之自動化威脅情資管理系統 (AETIM)」的完整系統需求規格，確保系統能夠：

1. **滿足合規要求**：符合 ISO 27001:2022 A.5.7 (威脅情資) 控制項要求
2. **自動化威脅情資管理**：建立完整的自動化流程，主動蒐集、分析外部威脅情資
3. **智能關聯分析**：將威脅情資與內部資產進行關聯性分析，計算風險分數
4. **產出可行動報告**：生成適合不同受眾的報告（管理層與技術層）
5. **即時通知機制**：根據風險等級發送差異化通知給相關人員

本文件遵循專案憲章（Project Constitution）的所有原則，特別是：
- **P3：清晰與可測試性**：每個使用者故事必須具有明確、可測試的驗收條件
- **P4：漸進式價值交付**：所有功能以小型、可驗證且獨立的增量交付
- **P5：主要語言**：所有內容使用正體中文（zh-TW）撰寫

---

## 2. 範圍

### 2.1 系統範圍

本系統涵蓋以下功能領域：

1. **基礎建設與情資定義**
   - 內部資產清冊管理
   - 優先情資需求 (PIR) 定義
   - 威脅情資來源訂閱管理

2. **自動化收集與關聯分析**
   - 多來源威脅情資自動收集
   - 威脅與資產關聯分析
   - 風險分數計算
   - 資料庫儲存與追蹤

3. **報告生成與即時通知**
   - CISO 週報生成
   - IT 工單生成
   - 多種通知機制

4. **Web 管理界面**
   - 系統設定與管理
   - 排程管理
   - 狀態監控
   - 報告檢視

### 2.2 系統邊界

**包含在範圍內：**
- 威脅情資的收集、分析、儲存與報告生成
- 內部資產清冊管理
- 風險評估與計算
- 通知機制
- Web 管理界面

**不包含在範圍內：**
- 實際的漏洞修補作業（僅提供建議與報告）
- 外部威脅情資來源的營運與維護（僅使用現有公開來源）
- 企業身份驗證系統的實作（需整合現有 IdP）

### 2.3 目標使用者

1. **資安官 (CISO/Security Officer)**
   - 檢視週報與威脅摘要
   - 設定優先情資需求
   - 管理系統設定

2. **IT 管理員 (IT Administrator)**
   - 管理內部資產清冊
   - 檢視 IT 工單
   - 設定排程與通知

3. **資安分析師 (Security Analyst)**
   - 檢視詳細威脅情資
   - 分析威脅與資產關聯
   - 檢視風險分數與建議

---

## 3. 權責

### 3.1 專案負責人
- 核准本需求文件
- 核准需求變更
- 確保專案遵循專案憲章

### 3.2 系統分析師
- 撰寫與維護本需求文件
- 與利害關係人確認需求
- 確保需求的可測試性

### 3.3 開發團隊
- 根據本文件進行系統設計與開發
- 確保實作符合需求規格
- 撰寫對應的測試案例

### 3.4 測試團隊
- 根據驗收條件撰寫測試案例
- 執行功能測試與整合測試
- 驗證系統符合需求

---

## 4. 名詞解釋

| 名詞 | 英文 | 說明 |
|------|------|------|
| 威脅情資 | Threat Intelligence | 關於網路威脅、漏洞、攻擊者及其戰術、技術和程序 (TTPs) 的資訊 |
| CVE | Common Vulnerabilities and Exposures | 公開已知資訊安全漏洞與暴露的標準化識別碼 |
| CVSS | Common Vulnerability Scoring System | 通用漏洞評分系統，用於評估漏洞的嚴重程度 |
| IOC | Indicator of Compromise | 入侵指標，用於識別惡意活動的證據 |
| TTP | Tactics, Techniques, and Procedures | 攻擊者的戰術、技術和程序 |
| PIR | Priority Intelligence Requirements | 優先情資需求，定義組織最關心的威脅類型 |
| CISO | Chief Information Security Officer | 資安長，負責組織的資訊安全策略與管理 |
| IdP | Identity Provider | 身份驗證提供者，提供統一身份驗證服務 |
| RBAC | Role-Based Access Control | 角色基礎存取控制，基於使用者角色進行授權 |
| DDD | Domain-Driven Design | 領域驅動設計，一種軟體開發方法論 |
| 有界上下文 | Bounded Context | DDD 中的概念，定義領域模型的邊界 |
| 模組化單體 | Modular Monolith | 一種架構模式，將系統組織為清晰的模組，但部署為單一應用程式 |
| 稽核日誌 | Audit Log | 記錄系統操作與資料存取，用於合規與安全審計 |
| 結構化日誌 | Structured Logging | 以結構化格式（如 JSON）記錄日誌，便於查詢與分析 |
| 分佈式追蹤 | Distributed Tracing | 追蹤跨模組的請求流程，用於診斷與效能分析 |

---

## 5. 作業內容

### 5.1 基礎建設與情資定義模組

#### 5.1.1 內部資產清冊管理

**使用者故事 US-001：作為 IT 管理員，我希望能夠匯入內部資產清冊，以便系統能夠進行威脅關聯分析。**

**驗收條件：**
- AC-001-1：系統必須支援從 CSV 檔案匯入資產清冊
- AC-001-2：CSV 檔案必須包含以下必要欄位：資產名稱、資產類型、產品名稱、產品版本、IP 位址（可選）、負責人（可選）
- AC-001-3：系統必須驗證 CSV 檔案格式，並在格式錯誤時顯示明確的錯誤訊息
- AC-001-4：系統必須在匯入前顯示預覽，讓使用者確認資料正確性
- AC-001-5：系統必須支援批次匯入，一次可處理至少 1000 筆資產記錄
- AC-001-6：系統必須在匯入完成後顯示成功匯入的筆數與失敗筆數（如有）
- AC-001-7：系統必須記錄資產匯入的稽核日誌（操作者、時間、匯入筆數）

**使用者故事 US-002：作為 IT 管理員，我希望能夠手動新增、修改、刪除資產記錄，以便維護最新的資產清冊。**

**驗收條件：**
- AC-002-1：系統必須提供資產清冊的 CRUD 操作介面
- AC-002-2：系統必須驗證必填欄位，防止儲存不完整的資料
- AC-002-3：系統必須在刪除資產前要求使用者確認
- AC-002-4：系統必須記錄所有資產異動的稽核日誌（操作者、時間、操作類型、資產識別碼）
- AC-002-5：系統必須支援資產的批次刪除功能
- AC-002-6：系統必須提供資產搜尋與篩選功能（依產品名稱、版本、類型等）

**使用者故事 US-003：作為資安分析師，我希望能夠檢視資產清冊，以便了解系統管理的資產範圍。**

**驗收條件：**
- AC-003-1：系統必須提供資產清冊的列表檢視
- AC-003-2：系統必須支援分頁顯示（每頁至少 20 筆）
- AC-003-3：系統必須支援依多個條件進行排序（資產名稱、產品名稱、版本等）
- AC-003-4：系統必須提供資產詳細資訊的檢視頁面

#### 5.1.2 優先情資需求 (PIR) 定義

**使用者故事 US-004：作為資安官，我希望能夠定義優先情資需求，以便系統能夠聚焦於對組織最重要的威脅。**

**驗收條件：**
- AC-004-1：系統必須允許定義多個 PIR 項目
- AC-004-2：每個 PIR 項目必須包含：名稱、描述、優先級（高/中/低）、關鍵字或條件
- AC-004-3：系統必須支援基於產品名稱、CVE 編號、威脅類型等條件定義 PIR
- AC-004-4：系統必須在威脅分析時優先處理符合 PIR 的威脅
- AC-004-5：系統必須記錄 PIR 的建立與修改稽核日誌

**使用者故事 US-005：作為資安官，我希望能夠啟用或停用 PIR 項目，以便動態調整威脅監控重點。**

**驗收條件：**
- AC-005-1：系統必須提供 PIR 項目的啟用/停用開關
- AC-005-2：停用的 PIR 項目不得影響威脅分析流程
- AC-005-3：系統必須記錄 PIR 啟用狀態變更的稽核日誌

#### 5.1.3 威脅情資來源訂閱管理

**使用者故事 US-006：作為 IT 管理員，我希望能夠設定威脅情資來源的訂閱，以便系統能夠自動收集威脅情資。**

**驗收條件：**
- AC-006-1：系統必須支援以下威脅情資來源：
  - CISA KEV (Known Exploited Vulnerabilities)
  - NVD (National Vulnerability Database)
  - VMware VMSA (VMware Security Advisories)
  - MSRC (Microsoft Security Response Center)
  - TWCERT (台灣電腦網路危機處理暨協調中心)
- AC-006-2：系統必須允許啟用或停用個別來源
- AC-006-3：系統必須允許設定每個來源的收集頻率（每小時、每日、每週等）
- AC-006-4：系統必須記錄來源訂閱設定的變更稽核日誌
- AC-006-5：系統必須顯示每個來源的最後收集時間與狀態

**使用者故事 US-007：作為 IT 管理員，我希望能夠檢視威脅情資來源的收集狀態，以便監控系統運作狀況。**

**驗收條件：**
- AC-007-1：系統必須顯示每個來源的收集狀態（成功、失敗、進行中）
- AC-007-2：系統必須顯示收集失敗的錯誤訊息
- AC-007-3：系統必須記錄每次收集作業的日誌（時間、來源、狀態、記錄數）

---

### 5.2 自動化收集與關聯分析模組

#### 5.2.1 自動化情資收集

**使用者故事 US-008：作為系統，我必須能夠自動從訂閱的來源收集威脅情資，以便持續監控威脅。**

**驗收條件：**
- AC-008-1：系統必須根據設定的排程自動執行收集作業
- AC-008-2：系統必須支援多個來源的並行收集（至少同時處理 3 個來源）
- AC-008-3：系統必須處理來源 API 的速率限制與錯誤重試機制
- AC-008-4：系統必須在收集失敗時記錄錯誤日誌，並在連續失敗時發送告警
- AC-008-5：系統必須解析不同來源的資料格式，並標準化為統一的資料模型
- AC-008-6：系統必須識別並提取 CVE 編號、產品名稱、版本資訊、CVSS 分數等關鍵資訊
- AC-008-7：系統必須使用 AI/NLP 技術處理非結構化資料（如 TWCERT 通報、資安新聞）

**使用者故事 US-009：作為系統，我必須能夠使用 AI 技術從非結構化內容中提取威脅資訊，以便處理各種格式的威脅情資。**

**驗收條件：**
- AC-009-1：系統必須能夠從文字內容中識別 CVE 編號（格式：CVE-YYYY-NNNNN）
- AC-009-2：系統必須能夠識別產品名稱與版本資訊
- AC-009-3：系統必須能夠識別 TTPs（戰術、技術和程序）
- AC-009-4：系統必須能夠識別 IOC（入侵指標）
- AC-009-5：系統必須對提取的資訊提供信心分數（Confidence Score）
- AC-009-6：系統必須記錄 AI 處理的日誌，包括輸入內容、提取結果與信心分數

#### 5.2.2 關聯分析引擎

**使用者故事 US-010：作為系統，我必須能夠比對威脅情資與內部資產，以便識別受影響的資產。**

**驗收條件：**
- AC-010-1：系統必須比對威脅情資中的產品名稱與版本與資產清冊
- AC-010-2：系統必須支援模糊比對（例如：產品名稱的變體、版本號的範圍比對）
- AC-010-3：系統必須識別所有受影響的資產，並建立威脅與資產的關聯記錄
- AC-010-4：系統必須在比對完成後更新威脅記錄的關聯狀態
- AC-010-5：系統必須記錄關聯分析的執行日誌（威脅 ID、比對結果、受影響資產數）

**使用者故事 US-011：作為資安分析師，我希望能夠檢視威脅與資產的關聯分析結果，以便了解威脅對組織的影響。**

**驗收條件：**
- AC-011-1：系統必須提供威脅詳細頁面，顯示所有受影響的資產
- AC-011-2：系統必須提供資產詳細頁面，顯示所有相關的威脅
- AC-011-3：系統必須支援依威脅嚴重程度、資產重要性等條件篩選關聯結果
- AC-011-4：系統必須提供關聯分析的視覺化呈現（例如：威脅-資產關係圖）

#### 5.2.3 風險分數計算

**使用者故事 US-012：作為系統，我必須能夠計算威脅的風險分數，以便優先處理高風險威脅。**

**驗收條件：**
- AC-012-1：系統必須基於 CVSS 分數計算基礎風險分數
- AC-012-2：系統必須考慮以下加權因子：
  - 資產重要性（高/中/低，權重：1.5/1.0/0.5）
  - 受影響資產數量（每增加 10 個資產，風險分數增加 0.1）
  - PIR 符合度（符合高優先級 PIR，風險分數增加 0.3）
  - 是否在 CISA KEV 清單中（是，風險分數增加 0.5）
- AC-012-3：系統必須計算最終風險分數（範圍：0.0 - 10.0）
- AC-012-4：系統必須根據風險分數將威脅分類為：嚴重（≥8.0）、高（6.0-7.9）、中（4.0-5.9）、低（<4.0）
- AC-012-5：系統必須記錄風險分數的計算過程（基礎分數、各加權因子、最終分數）

**使用者故事 US-013：作為資安分析師，我希望能夠檢視風險分數的計算詳情，以便理解風險評估的依據。**

**驗收條件：**
- AC-013-1：系統必須在威脅詳細頁面顯示風險分數的計算詳情
- AC-013-2：系統必須顯示基礎 CVSS 分數與各加權因子的貢獻
- AC-013-3：系統必須提供風險分數的歷史記錄（如風險分數因資產變更而更新）

#### 5.2.4 資料庫儲存與追蹤

**使用者故事 US-014：作為系統，我必須能夠將威脅情資與分析結果儲存至資料庫，以便長期追蹤與查詢。**

**驗收條件：**
- AC-014-1：系統必須將威脅情資儲存為結構化資料
- AC-014-2：系統必須儲存威脅的完整生命週期（收集時間、分析時間、風險分數變更歷史）
- AC-014-3：系統必須支援威脅狀態管理（新增、分析中、已處理、已關閉）
- AC-014-4：系統必須建立威脅與資產的關聯表，支援多對多關係
- AC-014-5：系統必須建立索引以支援高效能查詢（依 CVE、產品名稱、風險分數等）
- AC-014-6：系統必須實作資料保留政策（例如：保留至少 2 年的威脅記錄）

---

### 5.3 報告生成與即時通知模組

#### 5.3.1 CISO 週報生成

**使用者故事 US-015：作為資安官，我希望能夠收到每週的威脅情資摘要報告，以便向管理層報告資安狀況。**

**驗收條件：**
- AC-015-1：系統必須自動生成每週的 CISO 週報
- AC-015-2：週報必須包含以下內容：
  - 本週威脅情資摘要（威脅數量、嚴重威脅數量）
  - 嚴重威脅清單（風險分數 ≥ 8.0）
  - 受影響資產統計（依資產類型、重要性分類）
  - 風險趨勢分析（與上週比較）
  - AI 生成的業務風險描述（以非技術語言說明威脅對業務的影響）
- AC-015-3：週報必須支援 HTML 與 PDF 兩種格式
- AC-015-4：週報必須使用 AI 技術生成易於理解的摘要（針對非技術背景的管理層）
- AC-015-5：週報檔案必須儲存在 `reports/yyyy/yyyymm/` 目錄結構中
- AC-015-6：週報檔案命名格式：`CISO_Weekly_Report_yyyy-mm-dd.html` 或 `.pdf`

**使用者故事 US-016：作為資安官，我希望能夠自訂週報的排程與收件人，以便彈性管理報告分發。**

**驗收條件：**
- AC-016-1：系統必須允許設定週報的生成時間（例如：每週一上午 9:00）
- AC-016-2：系統必須允許設定多個收件人（Email 地址）
- AC-016-3：系統必須在生成週報後自動發送 Email 通知
- AC-016-4：系統必須記錄週報生成與發送的日誌

#### 5.3.2 IT 工單生成

**使用者故事 US-017：作為 IT 管理員，我希望能夠收到技術層的威脅處理工單，以便進行漏洞修補作業。**

**驗收條件：**
- AC-017-1：系統必須為每個嚴重或高風險威脅（風險分數 ≥ 6.0）生成 IT 工單
- AC-017-2：工單必須包含以下技術資訊：
  - CVE 編號與詳細描述
  - 受影響的資產清單（產品名稱、版本、IP 位址、負責人）
  - CVSS 分數與風險分數
  - 修補建議（修補程式連結、暫時緩解措施）
  - 優先處理順序
- AC-017-3：工單必須支援 TEXT 與 JSON 兩種格式
- AC-017-4：工單必須能夠匯出為檔案或透過 API 提供
- AC-017-5：系統必須追蹤工單狀態（待處理、處理中、已完成、已關閉）

**使用者故事 US-018：作為 IT 管理員，我希望能夠批次匯出多個工單，以便整合至工單管理系統。**

**驗收條件：**
- AC-018-1：系統必須支援批次匯出功能（可選取多個工單）
- AC-018-2：系統必須支援 JSON 格式的批次匯出（包含所有選取的工單）
- AC-018-3：系統必須記錄工單匯出的稽核日誌

#### 5.3.3 通知機制

**使用者故事 US-019：作為資安官，我希望能夠在發現嚴重威脅時立即收到通知，以便快速回應。**

**驗收條件：**
- AC-019-1：系統必須在發現嚴重威脅（風險分數 ≥ 8.0）時立即發送通知
- AC-019-2：通知必須包含：威脅標題、CVE 編號、風險分數、受影響資產數量、詳細資訊連結
- AC-019-3：系統必須支援 Email 通知
- AC-019-4：系統必須記錄通知發送的日誌（時間、收件人、威脅 ID）

**使用者故事 US-020：作為資安官，我希望能夠收到每日的高風險威脅摘要，以便掌握威脅狀況。**

**驗收條件：**
- AC-020-1：系統必須每日生成高風險威脅摘要（風險分數 ≥ 6.0）
- AC-020-2：摘要必須包含：威脅數量、威脅清單、受影響資產統計
- AC-020-3：系統必須在設定的時間（例如：每日上午 8:00）自動發送摘要
- AC-020-4：系統必須允許設定摘要的收件人與發送時間

**使用者故事 US-021：作為 IT 管理員，我希望能夠設定通知規則，以便控制通知的發送條件與收件人。**

**驗收條件：**
- AC-021-1：系統必須允許設定通知規則：
  - 嚴重威脅通知（風險分數 ≥ 8.0）
  - 高風險每日摘要（風險分數 ≥ 6.0）
  - 週報通知
- AC-021-2：系統必須允許為每種通知類型設定不同的收件人
- AC-021-3：系統必須允許啟用或停用個別通知類型
- AC-021-4：系統必須記錄通知規則的變更稽核日誌

---

### 5.4 Web 管理界面模組

#### 5.4.1 身份驗證與授權

**使用者故事 US-022：作為使用者，我必須能夠透過統一身份驗證系統登入，以便存取系統功能。**

**驗收條件：**
- AC-022-1：系統必須整合 OIDC/OAuth 2.0 身份驗證提供者 (IdP)
- AC-022-2：系統必須支援單一登入 (SSO) 功能
- AC-022-3：系統必須在登入失敗時顯示明確的錯誤訊息
- AC-022-4：系統必須記錄所有登入嘗試的稽核日誌（成功與失敗）

**使用者故事 US-023：作為系統，我必須能夠根據使用者角色控制功能存取，以便確保安全性。**

**驗收條件：**
- AC-023-1：系統必須實作角色基礎存取控制 (RBAC)
- AC-023-2：系統必須定義以下角色：
  - **資安官 (CISO)**：完整存取權限（檢視、設定、管理）
  - **IT 管理員 (IT Admin)**：資產管理、排程設定、工單檢視
  - **資安分析師 (Analyst)**：檢視威脅情資、分析結果、報告
  - **唯讀使用者 (Viewer)**：僅能檢視報告與威脅情資
- AC-023-3：系統必須在 UI 中隱藏使用者無權存取的功能
- AC-023-4：系統必須在 API 層級驗證權限，防止未授權存取
- AC-023-5：系統必須記錄所有權限驗證失敗的稽核日誌

#### 5.4.2 系統設定管理

**使用者故事 US-024：作為 IT 管理員，我希望能夠透過 Web 界面管理系統設定，以便維護系統運作。**

**驗收條件：**
- AC-024-1：系統必須提供系統設定的集中管理介面
- AC-024-2：系統必須支援以下設定類別：
  - 威脅情資來源訂閱
  - 通知規則
  - 報告排程
  - 資料保留政策
- AC-024-3：系統必須在儲存設定前要求使用者確認（明確的交易儲存）
- AC-024-4：系統必須提供「取消」按鈕，允許使用者放棄變更
- AC-024-5：系統必須記錄所有設定變更的稽核日誌

#### 5.4.3 排程管理

**使用者故事 US-025：作為 IT 管理員，我希望能夠設定威脅情資收集的排程，以便控制系統運作時間。**

**驗收條件：**
- AC-025-1：系統必須提供排程設定的可視化介面
- AC-025-2：系統必須支援 Cron 表達式或類似的排程語法
- AC-025-3：系統必須允許為每個威脅情資來源設定獨立的排程
- AC-025-4：系統必須顯示排程的執行歷史（最後執行時間、下次執行時間、執行狀態）
- AC-025-5：系統必須允許手動觸發排程執行（用於測試）

**使用者故事 US-026：作為 IT 管理員，我希望能夠設定週報的排程，以便自動生成與發送報告。**

**驗收條件：**
- AC-026-1：系統必須提供週報排程的可視化設定介面
- AC-026-2：系統必須允許設定週報的生成時間（例如：每週一上午 9:00）
- AC-026-3：系統必須允許設定週報的收件人清單
- AC-026-4：系統必須顯示週報排程的執行歷史
- AC-026-5：系統必須允許手動觸發週報生成（用於測試）

#### 5.4.4 狀態監控

**使用者故事 US-027：作為 IT 管理員，我希望能夠檢視系統的即時狀態，以便監控系統運作狀況。**

**驗收條件：**
- AC-027-1：系統必須提供儀表板 (Dashboard) 顯示系統狀態
- AC-027-2：儀表板必須顯示以下資訊：
  - 威脅情資收集狀態（各來源的最後收集時間與狀態）
  - 最近收集的威脅數量
  - 待處理的嚴重威脅數量
  - 系統健康狀態（資料庫連線、API 可用性等）
- AC-027-3：系統必須提供健康檢查端點 (Health Check Endpoint)
- AC-027-4：系統必須在系統異常時顯示告警訊息

**使用者故事 US-028：作為資安分析師，我希望能夠檢視威脅情資的統計資訊，以便了解威脅趨勢。**

**驗收條件：**
- AC-028-1：系統必須提供威脅情資的統計圖表：
  - 威脅數量趨勢（依時間）
  - 風險分數分布（嚴重/高/中/低）
  - 受影響資產統計（依資產類型）
  - 威脅來源統計（各來源的威脅數量）
- AC-028-2：系統必須支援時間範圍篩選（最近 7 天、30 天、90 天等）
- AC-028-3：系統必須提供圖表的匯出功能（PNG、PDF）

#### 5.4.5 報告檢視

**使用者故事 US-029：作為資安官，我希望能夠透過 Web 界面檢視歷史報告，以便追蹤威脅情資的變化。**

**驗收條件：**
- AC-029-1：系統必須提供報告列表頁面，顯示所有生成的報告
- AC-029-2：系統必須支援依報告類型（CISO 週報、IT 工單）與時間範圍篩選
- AC-029-3：系統必須允許線上檢視報告（HTML 格式）
- AC-029-4：系統必須允許下載報告檔案（HTML、PDF、JSON）
- AC-029-5：系統必須記錄報告檢視與下載的稽核日誌

---

### 5.5 非功能性需求

#### 5.5.1 效能要求

**NFR-001：系統回應時間**
- 威脅情資收集作業必須在 5 分鐘內完成單一來源的收集（假設來源 API 正常回應）
- Web 界面頁面載入時間必須在 2 秒內完成（在正常網路條件下）
- 威脅與資產關聯分析必須在 1 分鐘內完成（假設資產清冊 ≤ 10,000 筆）
- 報告生成必須在 3 分鐘內完成（假設威脅記錄 ≤ 1,000 筆）

**NFR-002：系統容量**
- 系統必須支援至少 10,000 筆資產記錄
- 系統必須支援至少 100,000 筆威脅記錄（2 年保留期間）
- 系統必須支援至少 10 個並行使用者
- 系統必須支援至少 5 個威脅情資來源的並行收集

**NFR-003：可用性**
- 系統必須達到 99% 的可用性（每月停機時間 ≤ 7.2 小時）
- 系統必須提供自動備份機制（每日備份資料庫）
- 系統必須提供災難復原計畫（RTO ≤ 4 小時，RPO ≤ 24 小時）

#### 5.5.2 安全性要求

**NFR-004：資料加密**
- 所有敏感資料必須在儲存時加密（at-rest encryption）
- 所有資料傳輸必須使用 TLS 1.2 或以上版本（in-transit encryption）
- 資料庫連線必須使用加密連線

**NFR-005：稽核日誌**
- 系統必須記錄所有涉及資料存取、修改、刪除的操作
- 稽核日誌必須包含：操作者、時間戳記、操作類型、資源識別碼、操作結果
- 稽核日誌必須不可篡改（使用數位簽章或寫入唯讀儲存）
- 稽核日誌必須保留至少 2 年

**NFR-006：輸入驗證**
- 系統必須驗證所有使用者輸入，防止 SQL 注入、XSS 等攻擊
- 系統必須限制檔案上傳的類型與大小（CSV 檔案 ≤ 10MB）
- 系統必須實作 API 速率限制（防止濫用）

#### 5.5.3 可觀測性要求

**NFR-007：日誌記錄**
- 系統必須使用結構化日誌（JSON 格式）
- 系統必須將日誌統一發送到中央日誌系統
- 系統必須記錄以下級別：DEBUG、INFO、WARN、ERROR、FATAL
- 系統必須記錄所有 API 請求與回應（包含請求 ID、回應時間、狀態碼）

**NFR-008：指標監控**
- 系統必須暴露健康檢查端點 (`/health`)
- 系統必須暴露關鍵效能指標（KPI）端點（例如：威脅收集成功率、平均回應時間）
- 系統必須支援 Prometheus 格式的指標匯出（如適用）

**NFR-009：追蹤**
- 系統必須實作分佈式追蹤（針對跨模組的 API 呼叫）
- 系統必須為每個請求分配唯一的追蹤 ID（Trace ID）
- 系統必須記錄請求的完整流程（從進入系統到回應）

#### 5.5.4 可維護性要求

**NFR-010：程式碼品質**
- 所有程式碼必須通過 Lint 檢查
- 所有程式碼必須遵循既定的命名規範（camelCase 變數、PascalCase 類別）
- 所有程式碼必須包含必要的 JSDoc 註解

**NFR-011：測試覆蓋率**
- 所有新功能必須具備對應的單元測試
- 單元測試覆蓋率必須達到至少 80%
- 所有關鍵業務邏輯必須具備整合測試

**NFR-012：文件化**
- 所有 API 必須提供 OpenAPI 3.x 規格文件
- 所有模組必須提供使用說明文件
- 所有資料庫 Schema 變更必須透過遷移工具管理

---

## 6. 參考文件

1. **專案憲章 (Project Constitution)**
   - 檔案：`1.專案憲章 Project Constitution：文件倉儲管理系統.md`
   - 版本：v2.1.0
   - 說明：定義專案的不可協商原則與規範

2. **專案概述文件**
   - 檔案：`0.AI代理人自動化威脅情資管理系統.md`
   - 版本：v1.0
   - 說明：專案的基本資訊與核心功能概述

3. **ISO 27001:2022**
   - 控制項：A.5.7 (威脅情資)
   - 說明：資訊安全管理系統標準

4. **CVSS 標準**
   - 版本：CVSS v3.1
   - 說明：通用漏洞評分系統

5. **OIDC/OAuth 2.0 規範**
   - 說明：身份驗證與授權協議

6. **OpenAPI 3.0 規格**
   - 說明：RESTful API 描述標準

---

## 7. 使用表單

### 7.1 資產清冊匯入表單

**檔案格式**：CSV  
**檔案大小限制**：≤ 10MB  
**必要欄位**：

| 欄位名稱 | 資料類型 | 說明 | 必填 | 範例 |
|---------|---------|------|------|------|
| ITEM | 數值 | 資產項目編號 | 否 | 1 |
| IP | 文字 | 資產的 IP 位址（可為單一 IP 或 IP 範圍） | 否 | 10.6.82.31 或 10.6.82.31～10.6.82.33 |
| 主機名稱 | 文字 | 資產的唯一識別名稱 | 是 | VMware 主機 |
| 作業系統(含版本) | 文字 | 作業系統名稱與版本資訊 | 是 | Windows Server 2016 Standard 1607 |
| 運行的應用程式(含版本) | 文字 | 運行的應用程式名稱與版本資訊（可包含多個應用程式） | 是 | Microsoft SQL Server 2017 (RTM-GDR) |
| 負責人 | 文字 | 資產負責人的 Email 或姓名 | 是 | 工程師 |
| 資料敏感度 | 選項 | 資料敏感度等級（高/中/低） | 是 | 高 |
| 是否對外(Public-facing) | 選項 | 資產是否對外暴露（Y/N） | 是 | Y |
| 業務關鍵性 | 選項 | 業務關鍵性等級（高/中/低） | 是 | 高 |

**欄位對應規則**：

系統需要從 CSV 欄位中解析出以下資訊，用於威脅關聯分析：

1. **產品名稱與版本解析**：
   - 從「運行的應用程式(含版本)」欄位中提取產品名稱與版本
   - 解析規則：
     - 標準格式：`產品名稱 版本號`（例如：`Microsoft SQL Server 2017`）
     - 包含版本資訊：`產品名稱 (版本資訊)`（例如：`VMware ESXi, 7.0.4`）
     - 自行開發系統：保留完整描述（例如：`自行開發 EEP(delphi7) 文件倉儲管理系統 v3.0`）
   - 系統必須支援模糊比對，以處理產品名稱的變體

2. **作業系統資訊**：
   - 從「作業系統(含版本)」欄位提取作業系統類型與版本
   - 用於比對作業系統相關的威脅（例如：Windows Server 2008 R2）

3. **資產屬性用於風險計算**：
   - 「資料敏感度」：用於風險分數加權（高=1.5, 中=1.0, 低=0.5）
   - 「是否對外」：用於識別對外暴露資產，符合 PIR-01 條件
   - 「業務關鍵性」：用於風險分數加權與優先級排序

**範例資料**：
```csv
ITEM,IP,主機名稱,作業系統(含版本),運行的應用程式(含版本),負責人,資料敏感度,是否對外(Public-facing),業務關鍵性
1,10.6.82.31～10.6.82.33,VMware 主機,VMware ESXi 7.0.3,VMware ESXi 7.0.4,工程師,高,N,高
2,59.120.48.163,文件倉儲管理系統（外部主機）,Windows Server 2016 Standard 1607,自行開發 EEP(delphi7) 文件倉儲管理系統 v3.0,工程師,高,Y,高
4,10.6.82.25,資料庫伺服器主機,Windows Server 2016 Standard 1607,Microsoft SQL Server 2017 (RTM-GDR) - 14.0.2070.1,工程師,高,N,高
```

**注意事項**：
- 系統必須驗證必填欄位，防止匯入不完整的資料
- 系統必須處理多行文字欄位（例如：運行的應用程式可能包含多行描述）
- 系統必須支援 IP 範圍格式（例如：`10.6.82.31～10.6.82.33`）
- 系統必須在匯入時自動解析產品名稱與版本，並建立對應關係

### 7.2 優先情資需求 (PIR) 定義表單

**欄位說明**：

| 欄位名稱 | 資料類型 | 說明 | 必填 |
|---------|---------|------|------|
| 名稱 | 文字 | PIR 項目的名稱 | 是 |
| 描述 | 文字 | PIR 項目的詳細描述 | 是 |
| 優先級 | 選項 | 優先級（高/中/低） | 是 |
| 條件類型 | 選項 | 條件類型（產品名稱、CVE 編號、威脅類型等） | 是 |
| 條件值 | 文字 | 條件的具體值（例如：產品名稱、CVE 前綴等） | 是 |
| 啟用狀態 | 布林值 | 是否啟用此 PIR | 是 |

### 7.3 威脅情資來源訂閱表單

**欄位說明**：

| 欄位名稱 | 資料類型 | 說明 | 必填 |
|---------|---------|------|------|
| 優先級 | 選項 | 來源的優先級（P0-緊急、P1-高、P2-中、P3-低） | 是 |
| 來源名稱 | 選項 | 威脅情資來源（CISA KEV、NVD、VMware VMSA、MSRC、TWCERT/CC、TW-CERT、OSINT、廠商安全通報） | 是 |
| 對應的 PIR(s) | 文字（多選） | 此來源對應的優先情資需求 (PIR) 項目，可選取多個 PIR | 是 |
| 啟用狀態 | 布林值 | 是否啟用此來源 | 是 |
| 收集頻率 | 選項 | 收集頻率（每小時、每日、每週等） | 是 |
| 收集策略 | 文字 | 收集策略與 AI 應用點說明 | 是 |
| API 金鑰/認證資訊 | 文字（可選） | 如來源需要 API 金鑰或認證資訊 | 否 |

**來源清單說明**：

| 來源名稱 | 優先級建議 | 資料格式 | 收集方式 | AI 應用點 |
|---------|-----------|---------|---------|----------|
| CISA KEV | P0 (緊急) | API / JSON Feed | API 自動收集 | 即時比對資產清單，觸發緊急警報 |
| NVD | P1 (高) | API | API 主動查詢（使用 CPEs） | 使用資產清單關鍵字進行主動查詢 |
| VMware VMSA | P1 (高) | RSS Feed | RSS 訂閱 | 自動解析安全通報內容 |
| MSRC | P1 (高) | RSS Feed | RSS 訂閱 | 自動解析安全通報內容 |
| TWCERT/CC & TW-CERT | P2 (中) | Email / RSS / Web | Email/RSS/Web 爬蟲 | NLP 處理中文非結構化內容，提取 IOCs |
| OSINT | P3 (低) | 多種格式 | 關鍵字監控（GitHub、Security Blogs） | 過濾雜訊，識別高度相關的攻擊模式 |

**收集策略說明**：

收集策略欄位應包含以下資訊：
- **收集方式**：API、RSS Feed、Email、Web 爬蟲等
- **AI 應用點**：說明此來源如何應用 AI 技術（例如：NLP 處理、IOC 提取、模式識別等）
- **特殊處理需求**：例如速率限制、認證方式、資料格式轉換等

**範例資料**：

| 優先級 | 來源名稱 | 對應的 PIR(s) | 啟用狀態 | 收集頻率 | 收集策略 | API 金鑰/認證資訊 |
|-------|---------|--------------|---------|---------|---------|------------------|
| P0 (緊急) | CISA KEV | PIR-04, PIR-01 | 是 | 每小時 | API / JSON Feed - 最高優先級，任何匹配資產的 CVE 將觸發即時緊急警報 | 無 |
| P1 (高) | NVD | PIR-01, PIR-02, PIR-03 | 是 | 每日 | API - 使用資產清單中的關鍵字 (CPEs) 進行主動查詢 | 無（公開 API） |
| P1 (高) | 廠商安全通報 | PIR-02, PIR-03 | 是 | 每日 | RSS Feeds - VMware VMSA 與 MSRC 的 RSS 訂閱 | 無 |
| P2 (中) | TWCERT/CC & TW-CERT | PIR-05, PIR-03 | 是 | 每日 | Email / RSS / Web 爬蟲 - AI 使用 NLP 處理中文通報，提取 IOCs | 無 |
| P3 (低) | OSINT | PIR-03 | 是 | 每週 | 關鍵字監控 - AI 過濾雜訊，僅在發現高度相關攻擊模式時提報 | 無 |

**注意事項**：
- 優先級 P0 來源的威脅情資將觸發即時通知（符合 US-019）
- 系統必須根據優先級決定收集順序與資源分配
- 對應的 PIR(s) 欄位用於篩選與關聯分析，僅處理符合相關 PIR 的威脅情資
- 收集策略中的 AI 應用點將影響威脅分析的處理流程

### 7.4 通知規則設定表單

**欄位說明**：

| 欄位名稱 | 資料類型 | 說明 | 必填 |
|---------|---------|------|------|
| 通知類型 | 選項 | 通知類型（嚴重威脅、高風險每日摘要、週報） | 是 |
| 啟用狀態 | 布林值 | 是否啟用此通知 | 是 |
| 風險分數閾值 | 數值 | 觸發通知的風險分數閾值（僅適用於嚴重威脅通知） | 條件必填 |
| 發送時間 | 時間 | 發送時間（僅適用於每日摘要與週報） | 條件必填 |
| 收件人清單 | 文字（多行） | 收件人 Email 地址清單（每行一個） | 是 |

---

## 附錄 A：使用者故事索引

| 使用者故事 ID | 標題 | 模組 | 優先級 |
|-------------|------|------|--------|
| US-001 | 匯入內部資產清冊 | 基礎建設 | 高 |
| US-002 | 手動管理資產記錄 | 基礎建設 | 高 |
| US-003 | 檢視資產清冊 | 基礎建設 | 中 |
| US-004 | 定義優先情資需求 | 基礎建設 | 高 |
| US-005 | 啟用/停用 PIR 項目 | 基礎建設 | 中 |
| US-006 | 設定威脅情資來源訂閱 | 基礎建設 | 高 |
| US-007 | 檢視來源收集狀態 | 基礎建設 | 中 |
| US-008 | 自動收集威脅情資 | 自動化收集 | 高 |
| US-009 | AI 提取威脅資訊 | 自動化收集 | 高 |
| US-010 | 比對威脅與資產 | 關聯分析 | 高 |
| US-011 | 檢視關聯分析結果 | 關聯分析 | 中 |
| US-012 | 計算風險分數 | 關聯分析 | 高 |
| US-013 | 檢視風險分數詳情 | 關聯分析 | 中 |
| US-014 | 儲存威脅情資 | 資料儲存 | 高 |
| US-015 | 生成 CISO 週報 | 報告生成 | 高 |
| US-016 | 自訂週報排程 | 報告生成 | 中 |
| US-017 | 生成 IT 工單 | 報告生成 | 高 |
| US-018 | 批次匯出工單 | 報告生成 | 中 |
| US-019 | 嚴重威脅即時通知 | 通知機制 | 高 |
| US-020 | 每日高風險摘要 | 通知機制 | 中 |
| US-021 | 設定通知規則 | 通知機制 | 中 |
| US-022 | 統一身份驗證 | Web 界面 | 高 |
| US-023 | 角色基礎存取控制 | Web 界面 | 高 |
| US-024 | 管理系統設定 | Web 界面 | 中 |
| US-025 | 設定收集排程 | Web 界面 | 中 |
| US-026 | 設定週報排程 | Web 界面 | 中 |
| US-027 | 檢視系統狀態 | Web 界面 | 中 |
| US-028 | 檢視威脅統計 | Web 界面 | 中 |
| US-029 | 檢視歷史報告 | Web 界面 | 中 |

---

## 附錄 B：驗收條件索引

本文件共定義 **100+ 個驗收條件**，每個驗收條件都對應至特定的使用者故事，並可作為測試案例的基礎。

驗收條件的命名規則：`AC-{US編號}-{序號}`

例如：
- `AC-001-1` 對應至 `US-001` 的第一個驗收條件
- `AC-015-3` 對應至 `US-015` 的第三個驗收條件

---

## 文件修訂記錄

| 版本 | 日期 | 修訂者 | 修訂內容 |
|------|------|--------|---------|
| v1.0.0 | 2025-11-21 | 系統分析師 | 初稿 |
| v1.0.0 | 2025-11-21 | 專案負責人 | 核准文件 |

---

**文件結束**

